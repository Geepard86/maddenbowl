<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MADDEN BOWL ‚Äì Hall of Fame</title>
  <style>
    :root{
      --nfl-blue:#013369; --nfl-red:#D50A0A;
      --bg:#0b1119; --card:#161f2c; --slot:#1c2431;
      --accent:#00ffcc; --gray:#4a5568; --border:#2d3748;
      --gold: #ffd700; --silver: #c0c0c0; --bronze: #cd7f32;
    }
    body{font-family:'Segoe UI',Roboto,sans-serif;background:var(--bg);color:#fff;margin:0;padding:12px;overflow-x:hidden;}
    .container{max-width:1400px;margin:0 auto;}
    h1{margin:10px 0 6px;text-align:center;letter-spacing:2px;text-transform:uppercase;border-bottom:3px solid var(--nfl-red);padding-bottom:6px;}
    
    .grid{display:grid;grid-template-columns:1fr;gap:12px;}
    @media(min-width:1100px){.grid{grid-template-columns:1fr 1fr;}}
    
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px;}
    .card h2{margin:0 0 10px;color:var(--accent);text-transform:uppercase;font-size:14px;letter-spacing:1px;display:flex;justify-content:space-between;}
    
    table{width:100%;border-collapse:collapse;font-size:12px;}
    th,td{padding:8px;text-align:center;border-bottom:1px solid var(--border);}
    th{color:rgba(255,255,255,0.7);text-transform:uppercase;font-size:10px;background:rgba(0,0,0,0.2);}
    td.name{text-align:left;font-weight:800;color:var(--accent);}
    
    .tabs{display:flex;gap:5px;flex-wrap:wrap;margin:10px 0;}
    .tab{cursor:pointer;padding:6px 10px;border-radius:8px;border:1px solid var(--border);background:rgba(0,0,0,0.18);font-weight:800;font-size:11px;}
    .tab.active{border-color:var(--accent);background:rgba(0,255,204,0.1);}
    
    .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-bottom:15px;}
    .kpi{background:rgba(0,0,0,0.25);border:1px solid var(--border);border-radius:10px;padding:8px;}
    .kpi .t{opacity:.7;font-size:10px;text-transform:uppercase;}
    .kpi .v{font-size:16px;font-weight:900;}
    
    .row{display:flex;justify-content:space-between;align-items:center;background:#232d3d;border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:8px;margin:5px 0; font-size: 12px;}
    .pill{padding:2px 6px;border-radius:999px;border:1px solid var(--border);background:rgba(0,0,0,0.2);font-size:10px;font-weight:700;}
    
    .rank-1{background:var(--gold);color:#000;}
    .rank-2{background:var(--silver);color:#000;}
    .rank-3{background:var(--bronze);color:#fff;}
    
    .new-record{border-left:4px solid var(--accent);background:rgba(0,255,204,0.08) !important; animation: glow 2s infinite alternate;}
    @keyframes glow { from { box-shadow: 0 0 5px rgba(0,255,204,0.1); } to { box-shadow: 0 0 15px rgba(0,255,204,0.3); } }

    .hidden{display:none;}
    .matrix-wrapper { overflow-x: auto; border: 1px solid var(--border); border-radius: 8px; }
    .history-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>MADDEN BOWL ‚Äì HALL OF FAME</h1>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
        <div style="display:flex; gap:10px; align-items:center;">
          <span class="pill">Ansicht:</span>
          <div class="tabs" style="margin:0;">
            <div class="tab active" data-tab="main" onclick="switchMainTab('main')">Dashboard</div>
            <div class="tab" data-tab="mastergrid" onclick="switchMainTab('mastergrid')">Master Grid</div>
            <div class="tab" data-tab="coachhistory" onclick="switchMainTab('coachhistory')">Coach History</div>
            <div class="tab" data-tab="teamstats" onclick="switchMainTab('teamstats')">NFL Franchises</div>
          </div>
        </div>
        <select id="seasonSelect" onchange="renderSeason()" style="background:#0b1119; color:#fff; border:1px solid var(--gray); padding:5px; border-radius:5px;"></select>
      </div>
    </div>

    <div id="view-mastergrid" class="card hidden"><h2>Master Grid Matrix</h2><div class="matrix-wrapper" id="gridContent"></div></div>
    
    <div id="view-coachhistory" class="card hidden"><h2>Coach Chroniken</h2><div class="history-grid" id="historyContent"></div></div>

    <div id="view-teamstats" class="card hidden"><h2>NFL Team Performance</h2><div id="teamContent"></div></div>

    <div id="view-main" class="grid">
      <div class="section">
        <div class="card">
          <h2>Saison <span id="curSeasonTitle"></span> Overview</h2>
          <div id="seasonKpis" class="kpis"></div>
          
          <div id="seasonAwards" style="margin-bottom:15px; display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>

          <div class="tabs">
            <div class="tab active" data-sub="st-table" onclick="setSubTab('st-table')">Tabelle</div>
            <div class="tab" data-sub="st-stats" onclick="setSubTab('st-stats')">Player Stats</div>
          </div>
          <div id="sub-st-table"></div>
          <div id="sub-st-stats" class="hidden"></div>
        </div>
      </div>

      <div class="section">
        <div class="card">
          <h2>Ewige Rangliste</h2>
          <div id="alltimeKpis" class="kpis"></div>
          <div id="at-table-wrap"></div>
        </div>

        <div class="card">
          <h2>All-Time Rekorde & Meilensteine</h2>
          <div id="at-records-wrap"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const HOF_SOURCES = ["maddenbowl_2022.json", "maddenbowl_2023.json", "maddenbowl_2024.json", "maddenbowl_2025.json", "maddenbowl_2026.json"];
    let hof = { seasons: [], seasonMap: new Map(), allTime: null, latestSeason: null };

    async function loadData() {
      const loaded = [];
      for (const f of HOF_SOURCES) {
        try {
          const res = await fetch(f, { cache: "no-store" });
          if (!res.ok) continue;
          const json = await res.json();
          const s = json.tournament || json;
          loaded.push({
            season: Number(json.season || s.season),
            players: s.players || [],
            standings: s.standings || [],
            matches: s.matches || []
          });
        } catch (e) {}
      }
      hof.seasons = loaded.sort((a,b) => b.season - a.season);
      hof.latestSeason = hof.seasons[0].season;
      hof.seasonMap = new Map(hof.seasons.map(s => [s.season, s]));
      
      document.getElementById("seasonSelect").innerHTML = hof.seasons.map(s => `<option value="${s.season}">${s.season}</option>`).join("");
      
      renderAllTime();
      renderSeason();
    }

    function getPlayerSeasonStats(s) {
      const stats = new Map();
      s.standings.forEach(st => stats.set(st.name, { name:st.name, rank:st.rank, points:st.points, g:0, w:0, l:0, pf:0, pa:0 }));
      s.matches.forEach(m => {
        const h = stats.get(m.homePlayer), a = stats.get(m.awayPlayer);
        if(!h || !a || m.homeScore === null) return;
        h.g++; h.pf += m.homeScore; h.pa += m.awayScore; if(m.homeScore > m.awayScore) h.w++; else h.l++;
        a.g++; a.pf += m.awayScore; a.pa += m.homeScore; if(m.awayScore > m.homeScore) a.w++; else a.l++;
      });
      return stats;
    }

    function renderSeason() {
      const sId = Number(document.getElementById("seasonSelect").value);
      const s = hof.seasonMap.get(sId);
      document.getElementById("curSeasonTitle").innerText = sId;
      
      const statsMap = getPlayerSeasonStats(s);
      const stats = [...statsMap.values()];
      
      // Awards
      const o = stats.sort((a,b) => (b.pf/b.g) - (a.pf/a.g))[0];
      const d = stats.sort((a,b) => (a.pa/a.g) - (b.pa/b.g))[0];
      document.getElementById("seasonAwards").innerHTML = `
        <div class="row" style="border-top:2px solid var(--accent)"><div><b>OCOTY</b><br><small>${o?.name || '?'}</small></div><div>${(o?.pf/o?.g || 0).toFixed(1)}</div></div>
        <div class="row" style="border-top:2px solid var(--nfl-red)"><div><b>DCOTY</b><br><small>${d?.name || '?'}</small></div><div>${(d?.pa/d?.g || 0).toFixed(1)}</div></div>`;

      // Table
      let html = `<table><tr><th>#</th><th>Coach</th><th>Team</th><th>Pkt</th></tr>`;
      s.standings.sort((a,b)=>a.rank-b.rank).forEach(st => {
        const team = s.players.find(p=>p.name===st.name)?.team || "‚Äî";
        html += `<tr><td><span class="pill ${st.rank<=3?'rank-'+st.rank:''}">${st.rank}</span></td><td class="name">${st.name}</td><td>${team}</td><td>${st.points}</td></tr>`;
      });
      document.getElementById("sub-st-table").innerHTML = html + "</table>";
    }

    function renderAllTime() {
      const all = new Map();
      const records = []; // {label, value, holder, isNew}
      
      // Helper for records
      const checkRecord = (label, val, holder, season) => {
        const existing = records.find(r => r.label === label);
        const isLatest = (season === hof.latestSeason);
        if(!existing || val > existing.value) {
          if(existing) { existing.value = val; existing.holder = holder; existing.isNew = isLatest; }
          else records.push({label, value: val, holder, isNew: isLatest});
        } else if (val === existing.value && isLatest) {
          existing.isNew = true; // Mark as new if reached in latest season
          if(!existing.holder.includes(holder)) existing.holder += ", " + holder;
        }
      };

      // Aggregate
      hof.seasons.slice().reverse().forEach(s => {
        const sStats = getPlayerSeasonStats(s);
        sStats.forEach(p => {
          if(!all.has(p.name)) all.set(p.name, {name:p.name, titles:0, points:0, games:0, wins:0, pf:0});
          const a = all.get(p.name);
          a.points += p.points; a.games += p.g; a.wins += p.w; a.pf += p.pf;
          if(p.rank === 1) a.titles++;
          
          checkRecord("Meiste Siege", a.wins, a.name, s.season);
          checkRecord("Ewige Punkte", a.points, a.name, s.season);
          checkRecord("Meiste Titel", a.titles, a.name, s.season);
        });

        // Match Records
        s.matches.forEach(m => {
          if(m.homeScore === null) return;
          checkRecord("H√∂chster Score (Spiel)", Math.max(m.homeScore, m.awayScore), (m.homeScore > m.awayScore ? m.homePlayer : m.awayPlayer), s.season);
          checkRecord("Punkte-Feuerwerk (Gesamt)", (m.homeScore + m.awayScore), `${m.homePlayer} vs ${m.awayPlayer}`, s.season);
        });
      });

      // Render Table
      const sorted = [...all.values()].sort((a,b) => b.titles - a.titles || b.points - a.points);
      let html = `<table><tr><th>#</th><th>Coach</th><th>üèÜ</th><th>Pkt</th><th>Win%</th></tr>`;
      sorted.forEach((p, i) => {
        html += `<tr><td>${i+1}</td><td class="name">${p.name}</td><td>${p.titles}</td><td>${p.points}</td><td>${(p.wins/p.games*100).toFixed(1)}%</td></tr>`;
      });
      document.getElementById("at-table-wrap").innerHTML = html + "</table>";

      // Render Records
      document.getElementById("at-records-wrap").innerHTML = records.map(r => `
        <div class="row ${r.isNew ? 'new-record' : ''}">
          <div><b>${r.label}</b><br><small class="muted">${r.holder}</small></div>
          <div style="font-weight:900; color:${r.isNew ? 'var(--accent)' : 'inherit'}">${r.value} ${r.isNew ? '‚≠ê' : ''}</div>
        </div>
      `).join("");
    }

    function switchMainTab(tab) {
      ["main", "mastergrid", "coachhistory", "teamstats"].forEach(t => {
        document.getElementById("view-"+t).classList.toggle("hidden", t !== tab);
        document.querySelector(`[data-tab="${t}"]`).classList.toggle("active", t === tab);
      });
      if(tab === 'mastergrid') renderGrid();
      if(tab === 'coachhistory') renderHistory();
      if(tab === 'teamstats') renderTeams();
    }

    function renderGrid() {
      const players = [...new Set(hof.seasons.flatMap(s => s.standings.map(st => st.name)))].sort();
      const years = [...hof.seasons].map(s => s.season).sort();
      let h = `<table><tr><th>Coach</th>${years.map(y => `<th>${y}</th>`).join("")}</tr>`;
      players.forEach(p => {
        h += `<tr><td class="name">${p}</td>`;
        years.forEach(y => {
          const s = hof.seasonMap.get(y);
          const st = s.standings.find(x => x.name === p);
          const tm = s.players.find(x => x.name === p)?.team || "";
          h += st ? `<td><div style="font-size:9px">${tm}</div><span class="pill ${st.rank<=3?'rank-'+st.rank:''}">#${st.rank}</span></td>` : `<td>‚Äî</td>`;
        });
        h += `</tr>`;
      });
      document.getElementById("gridContent").innerHTML = h + "</table>";
    }

    function renderHistory() {
      const coaches = new Map();
      hof.seasons.slice().reverse().forEach(s => {
        s.standings.forEach(st => {
          if(!coaches.has(st.name)) coaches.set(st.name, []);
          const team = s.players.find(p => p.name === st.name)?.team || "???";
          coaches.get(st.name).push({y: s.season, t: team, r: st.rank});
        });
      });
      let h = "";
      [...coaches.keys()].sort().forEach(name => {
        h += `<div class="card" style="margin-bottom:5px;"><h3>${name}</h3>`;
        coaches.get(name).reverse().forEach(entry => {
          h += `<div class="row"><span>${entry.y}: ${entry.t}</span><span class="pill ${entry.r<=3?'rank-'+entry.r:''}">#${entry.r}</span></div>`;
        });
        h += `</div>`;
      });
      document.getElementById("historyContent").innerHTML = h;
    }

    function renderTeams() {
      const tMap = new Map();
      hof.seasons.forEach(s => s.players.forEach(p => {
        if(!tMap.has(p.team)) tMap.set(p.team, {n:p.team, p:0, w:0});
        const t = tMap.get(p.team); t.p++;
        if(s.standings.find(st => st.rank === 1 && st.name === p.name)) t.w++;
      }));
      let h = `<table><tr><th>NFL Team</th><th>Picks</th><th>Titel</th></tr>`;
      [...tMap.values()].sort((a,b)=>b.p-a.p).forEach(t => {
        h += `<tr><td class="name">${t.n}</td><td>${t.p}</td><td class="ok">${t.w}</td></tr>`;
      });
      document.getElementById("teamContent").innerHTML = h + "</table>";
    }

    function setSubTab(n) {
      document.querySelectorAll("[data-sub]").forEach(el => el.classList.toggle("active", el.dataset.sub === n));
      document.getElementById("sub-st-table").classList.toggle("hidden", n !== "st-table");
      document.getElementById("sub-st-stats").classList.toggle("hidden", n !== "st-stats");
    }

    window.onload = loadData;
  </script>
</body>
</html>
